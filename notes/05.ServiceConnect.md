# Android05--Android服务通信

标签： Android

---
[TOC]

## 传递参数到Service
我们知道，Activity可以传递参数到另一个Activity，Service同样可以接收来自Activity传来的参数。  

下面是个示例，新建个应用程序`LearnServicePutArgs`，并新建`MyService`继承`Service`。当我们启动服务的时候传递文本输入框的参数到Service，Service接收并打印出来。  

先注册服务：
``` xml
<service android:name=".MyService"></service>
```

下面是Service代码：  
MyService.java
``` java 
package com.a52fhy.learnserviceputargs;

import android.app.Service;
import android.content.Context;
import android.content.Intent;
import android.os.IBinder;
import android.support.annotation.Nullable;

/**
 * Created by YJC on 2016/9/18 018.
 */
public class MyService extends Service {

    private boolean running = false;
    public String data = "默认信息";

    @Nullable
    @Override
    public IBinder onBind(Intent intent) {
        return null;
    }

    @Override
    public void onCreate() {
        super.onCreate();

        running = true;

        new Thread(){
            @Override
            public void run() {
                super.run();

                while(running){
                    System.out.println(data);
                    try {
                        sleep(500);
                    } catch (InterruptedException e) {
                        e.printStackTrace();
                    }
                }
            }
        }.start();
    }

    @Override
    public int onStartCommand(Intent intent, int flags, int startId) {

        data = intent.getStringExtra("name");

        return super.onStartCommand(intent, flags, startId);
    }

    @Override
    public void onDestroy() {
        super.onDestroy();

        running = false;
    }
}
```
在`onCreate()`里我们运行了一个线程，不断循环输出字符串。  

MainActivity代码：
``` java
package com.a52fhy.learnserviceputargs;

import android.content.Intent;
import android.support.v7.app.AppCompatActivity;
import android.os.Bundle;
import android.view.View;
import android.widget.EditText;

public class MainActivity extends AppCompatActivity implements View.OnClickListener {

    @Override
    protected void onCreate(Bundle savedInstanceState) {
        super.onCreate(savedInstanceState);
        setContentView(R.layout.activity_main);

        findViewById(R.id.btnStartService).setOnClickListener(this);
        findViewById(R.id.btnStopService).setOnClickListener(this);
    }

    /**
     * Called when a view has been clicked.
     *
     * @param v The view that was clicked.
     */
    @Override
    public void onClick(View v) {

        String name = ((EditText)findViewById(R.id.etString)).getText().toString();
        Intent i = new Intent(this, MyService.class);
        i.putExtra("name",  name);

        switch (v.getId()){
            case R.id.btnStartService:
                startService(i);
                break;
            case R.id.btnStopService:
                stopService(i);
                break;
        }
    }
}

```
程序设定了2个按钮，分别是启动服务和停止服务。启动服务的时候获取文本框的值，并传递到服务里。    

程序运行结果：    
1) 开始服务：  
```
com.a52fhy.learnserviceputargs I/System.out: 默认信息
com.a52fhy.learnserviceputargs I/System.out: Hello World!
com.a52fhy.learnserviceputargs I/System.out: Hello World!
...
```
2) 编辑文本，再次开始服务：  
```
com.a52fhy.learnserviceputargs I/System.out: 啦啦啦
com.a52fhy.learnserviceputargs I/System.out: 啦啦啦
...
```

`开始服务`的时候，程序执行`onCreate()`，这时候`running = true`且`data`是默认值`默认信息`，所以输出了`默认信息`；程序继续执行了`onStartCommand()`，这时候`data`被赋新值`Hello World!`，输出了`Hello World!`；后面程序一直运行，输出的都是`Hello World!`。  

`编辑文本，再次开始服务`的时候，程序不再执行`onCreate()`，而是执行了`onStartCommand()`，`data`被赋新值，所以输出的也是新值`啦啦啦`。  

如果我们把线程放到`onStartCommand()`，就不会输出第一行的`默认信息`。




