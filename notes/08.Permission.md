# Android08--Android权限系统

标签： Android

---
[TOC]

## 声明需要的权限

有时候我们需要给APP添加相应的权限，如webview需要有访问网络的权限：
``` xml
<uses-permission android:name="android.permission.INTERNET"></uses-permission>
```

通讯录需要有访问联系人的权限：
``` xml
<uses-permission android:name="android.permission.READ_CONTACTS"></uses-permission>
```

## 自定义权限
使用permission标签自定义权限：
```
<permission android:name="com.a52fhy.learnpemission.permission.RECEIVE_MSG"></permission>
```
命名规则：`包名` + `.permission` + `.权限名大写`。

## 为代码添加权限检查

使用`context.checkCallingOrSelfPermission()`检查是否拥有某个权限，然后与常量`PackageManager.PERMISSION_GRANTED`进行比较，不通过则提示没有权限。  

下面是一个发送广播的示例，自定义了权限`com.a52fhy.learnpemission.permission.RECEIVE_MSG`，并在接收广播的时候进行判断：  

MyReceiver.java
``` java 
package com.a52fhy.learnpermission;

import android.content.BroadcastReceiver;
import android.content.Context;
import android.content.Intent;
import android.content.pm.PackageManager;
import android.util.Log;
import android.widget.Toast;

public class MyReceiver extends BroadcastReceiver {

    public final static String PERMISSION_RECEIVE_MSG = "com.a52fhy.learnpemission.permission.RECEIVE_MSG";

    public MyReceiver() {
    }

    @Override
    public void onReceive(Context context, Intent intent) {

        int checkResult = context.checkCallingOrSelfPermission(PERMISSION_RECEIVE_MSG);
        if(checkResult != PackageManager.PERMISSION_GRANTED){
            //throw  new SecurityException("没有权限：" + PERMISSION_RECEIVE_MSG);
            Toast.makeText(context, "没有权限：" + PERMISSION_RECEIVE_MSG, Toast.LENGTH_LONG).show();
        }else{
            Log.i("MyReceiver", "接收到了消息！");
        }
    }
}
```

`PackageManager.PERMISSION_GRANTED`对应的值是`0`。其它常量：
``` java 
public static final int PERMISSION_GRANTED = 0;
public static final int PERMISSION_DENIED = -1;
```

我们运行APP，点击发送广播，会提示没有权限。  

现在我们添加上这个权限：
``` xml
<uses-permission android:name="com.a52fhy.learnpemission.permission.RECEIVE_MSG"></uses-permission>
```
运行就没有问题了。

## 为基本组件添加权限检查

## 常见权限




